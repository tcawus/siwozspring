DROP TABLE Visit IF EXISTS;
DROP TABLE HistoricalVisit IF EXISTS;
DROP TABLE Employee IF EXISTS;
DROP TABLE Patient2Company IF EXISTS;
DROP TABLE Company IF EXISTS;
DROP TABLE Patient IF EXISTS;
DROP TABLE Person IF EXISTS;
DROP TABLE EmployeeStatus IF EXISTS;
DROP TABLE Address IF EXISTS;

CREATE TABLE Person (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	name VARCHAR(64),
	surname VARCHAR(128),
	email VARCHAR(128),
	pass VARCHAR(256),
	pesel CHAR(11),
	registerDate TIMESTAMP
);

CREATE TABLE Patient (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	idPerson INTEGER FOREIGN KEY REFERENCES Person(id)
);

CREATE TABLE EmployeeStatus (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	statusName varchar(32)
);

CREATE TABLE Address (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	city varchar(64),
	street varchar(64)
);

CREATE TABLE Company (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	city varchar(128),
	street varchar(512),
	idAddress INTEGER FOREIGN KEY REFERENCES Address(id)
);

CREATE TABLE Employee (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	idEmployeeStatus INTEGER FOREIGN KEY REFERENCES EmployeeStatus(id),
	idPerson INTEGER FOREIGN KEY REFERENCES Person(id),
	idCompany INTEGER FOREIGN KEY REFERENCES Company(id)
);


CREATE TABLE Patient2Company (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	idPatient INTEGER FOREIGN KEY REFERENCES Patient(id),
	idCompany INTEGER FOREIGN KEY REFERENCES Company(id)
);

CREATE TABLE Visit (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	visitDate TIMESTAMP,
	idPatient2Company INTEGER FOREIGN KEY REFERENCES Patient2Company(id),
	idEmployee INTEGER FOREIGN KEY REFERENCES Employee(id)
);

CREATE TABLE HistoricalVisit (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY primary key,
	visitDate TIMESTAMP,
	idPatient2Company INTEGER FOREIGN KEY REFERENCES Patient2Company(id),
	idEmployee INTEGER FOREIGN KEY REFERENCES Employee(id)
);